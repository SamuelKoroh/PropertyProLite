{"version":3,"sources":["../../server/controllers/users.js"],"names":["filterUsers","users","query","filteredUsers","filter","u","user_type","toLowerCase","startsWith","first_name","last_name","phone_number","email","is_active","getAllUser","res","Users","search","length","map","_","omit","getUserProfile","user","userProfile","find","parseInt","id","getUserProperties","params","userId","userAdverts","Properties","p","owner","updateUserProfile","file","body","keys","Object","forEach","key","result","cloudinary","v2","uploader","upload","path","image","secure_url","error","activateDeactivateUserProfile","deleteUserProfile","index","indexOf","splice","message"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,WAAW,GAAG,CAACC,KAAD,EAAQC,KAAR,KAAkB;AACpC,MAAIC,aAAa,GAAGF,KAApB;;AACA,MAAIC,KAAJ,EAAW;AACTC,IAAAA,aAAa,GAAGA,aAAa,CAACC,MAAd,CACdC,CAAC,IACCA,CAAC,CAACC,SAAF,CAAYC,WAAZ,GAA0BC,UAA1B,CAAqCN,KAAK,CAACK,WAAN,EAArC,KACGF,CAAC,CAACI,UAAF,CAAaF,WAAb,GAA2BC,UAA3B,CAAsCN,KAAK,CAACK,WAAN,EAAtC,CADH,IAEGF,CAAC,CAACK,SAAF,CAAYH,WAAZ,GAA0BC,UAA1B,CAAqCN,KAAK,CAACK,WAAN,EAArC,CAFH,IAGGF,CAAC,CAACM,YAAF,CAAeJ,WAAf,GAA6BC,UAA7B,CAAwCN,KAAK,CAACK,WAAN,EAAxC,CAHH,IAIGF,CAAC,CAACO,KAAF,CAAQL,WAAR,GAAsBC,UAAtB,CAAiCN,KAAK,CAACK,WAAN,EAAjC,CAJH,IAKGF,CAAC,CAACQ,SAAF,KAAgBX,KAPP,CAAhB;AASD;;AACD,SAAOC,aAAP;AACD,CAdD;AAgBA;;;;;;;AAKO,MAAMW,UAAU,GAAG,CAAC;AAAEZ,EAAAA;AAAF,CAAD,EAAYa,GAAZ,KAAoB;AAC5C,MAAId,KAAK,GAAGD,WAAW,CAACgB,cAAD,EAAQd,KAAK,CAACe,MAAd,CAAvB;AACA,MAAI,CAAChB,KAAK,CAACiB,MAAX,EAAmB,OAAO,4BAAWH,GAAX,EAAgB,6BAAhB,CAAP;AACnBd,EAAAA,KAAK,GAAGA,KAAK,CAACkB,GAAN,CAAUd,CAAC,IAAIe,gBAAEC,IAAF,CAAOhB,CAAP,EAAU,CAAC,UAAD,EAAa,OAAb,CAAV,CAAf,CAAR;AACA,8BAAWU,GAAX,EAAgBd,KAAhB;AACD,CALM;AAOP;;;;;;;;;AAKO,MAAMqB,cAAc,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,EAAWR,GAAX,KAAmB;AAC/C,QAAMS,WAAW,GAAGR,eAAMS,IAAN,CAAWpB,CAAC,IAAIqB,QAAQ,CAACrB,CAAC,CAACsB,EAAH,EAAO,EAAP,CAAR,KAAuBD,QAAQ,CAACH,IAAI,CAACI,EAAN,EAAU,EAAV,CAA/C,CAApB;;AACA,8BAAWZ,GAAX,EAAgBK,gBAAEC,IAAF,CAAOG,WAAP,EAAoB,CAAC,UAAD,EAAa,OAAb,CAApB,CAAhB;AACD,CAHM;AAKP;;;;;;;;;AAKO,MAAMI,iBAAiB,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,EAAad,GAAb,KAAqB;AACpD,QAAMQ,IAAI,GAAGP,eAAMS,IAAN,CAAWpB,CAAC,IAAIqB,QAAQ,CAACrB,CAAC,CAACsB,EAAH,EAAO,EAAP,CAAR,KAAuBD,QAAQ,CAACG,MAAM,CAACC,MAAR,EAAgB,EAAhB,CAA/C,CAAb;;AACA,MAAI,CAACP,IAAL,EAAW,OAAO,4BAAWR,GAAX,EAAgB,yBAAhB,CAAP;;AACX,QAAMgB,WAAW,GAAGC,oBAAW5B,MAAX,CAAkB6B,CAAC,IAAIP,QAAQ,CAACO,CAAC,CAACC,KAAH,EAAU,EAAV,CAAR,KAA0BR,QAAQ,CAACG,MAAM,CAACC,MAAR,EAAgB,EAAhB,CAAzD,CAApB;;AACA,8BAAWf,GAAX,EAAgB;AAAEQ,IAAAA,IAAI,EAAEH,gBAAEC,IAAF,CAAOE,IAAP,EAAa,CAAC,UAAD,EAAa,OAAb,CAAb,CAAR;AAA6CQ,IAAAA;AAA7C,GAAhB;AACD,CALM;AAOP;;;;;;;;;AAKO,MAAMI,iBAAiB,GAAG,OAAO;AAAEN,EAAAA,MAAF;AAAUO,EAAAA,IAAV;AAAgBC,EAAAA;AAAhB,CAAP,EAA+BtB,GAA/B,KAAuC;AACtE,MAAI;AACF,UAAMQ,IAAI,GAAGP,eAAMS,IAAN,CAAWpB,CAAC,IAAIqB,QAAQ,CAACrB,CAAC,CAACsB,EAAH,EAAO,EAAP,CAAR,KAAuBD,QAAQ,CAACG,MAAM,CAACC,MAAR,EAAgB,EAAhB,CAA/C,CAAb;;AACA,QAAI,CAACP,IAAL,EAAW,OAAO,4BAAWR,GAAX,EAAgB,yBAAhB,CAAP;AAEX,UAAMuB,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYD,IAAZ,CAAb;AACAC,IAAAA,IAAI,CAACE,OAAL,CAAcC,GAAD,IAAS;AACpBlB,MAAAA,IAAI,CAACkB,GAAD,CAAJ,GAAYJ,IAAI,CAACI,GAAD,CAAhB;AACD,KAFD;;AAIA,QAAIL,IAAJ,EAAU;AACR,YAAMM,MAAM,GAAG,MAAMC,oBAAWC,EAAX,CAAcC,QAAd,CAAuBC,MAAvB,CAA8BV,IAAI,CAACW,IAAnC,CAArB;AACAxB,MAAAA,IAAI,CAACyB,KAAL,GAAaN,MAAM,CAACO,UAApB;AACD;;AACD,WAAO,4BAAWlC,GAAX,EAAgB,EAAE,GAAGK,gBAAEC,IAAF,CAAOE,IAAP,EAAa,CAAC,UAAD,CAAb;AAAL,KAAhB,CAAP;AACD,GAdD,CAcE,OAAO2B,KAAP,EAAc;AACd,gCAAWnC,GAAX,EAAgB,iBAAhB,EAAmC,GAAnC;AACD;AACF,CAlBM;AAoBP;;;;;;;;;AAKO,MAAMoC,6BAA6B,GAAG,CAAC;AAAEtB,EAAAA;AAAF,CAAD,EAAad,GAAb,KAAqB;AAChE,QAAMS,WAAW,GAAGR,eAAMS,IAAN,CAAWpB,CAAC,IAAIqB,QAAQ,CAACrB,CAAC,CAACsB,EAAH,EAAO,EAAP,CAAR,KAAuBD,QAAQ,CAACG,MAAM,CAACC,MAAR,EAAgB,EAAhB,CAA/C,CAApB;;AACA,MAAI,CAACN,WAAL,EAAkB,OAAO,4BAAWT,GAAX,EAAgB,iCAAhB,CAAP;AAClBS,EAAAA,WAAW,CAACX,SAAZ,GAAwB,CAACW,WAAW,CAACX,SAArC;AACA,8BAAWE,GAAX,EAAgBK,gBAAEC,IAAF,CAAOG,WAAP,EAAoB,CAAC,UAAD,EAAa,OAAb,CAApB,CAAhB;AACD,CALM;AAOP;;;;;;;;;AAKO,MAAM4B,iBAAiB,GAAG,CAAC;AAAEvB,EAAAA;AAAF,CAAD,EAAad,GAAb,KAAqB;AACpD,QAAMS,WAAW,GAAGR,eAAMS,IAAN,CAAWpB,CAAC,IAAIqB,QAAQ,CAACrB,CAAC,CAACsB,EAAH,EAAO,EAAP,CAAR,KAAuBD,QAAQ,CAACG,MAAM,CAACC,MAAR,EAAgB,EAAhB,CAA/C,CAApB;;AACA,MAAI,CAACN,WAAL,EAAkB,OAAO,4BAAWT,GAAX,EAAgB,qDAAhB,CAAP;;AAClB,QAAMsC,KAAK,GAAGrC,eAAMsC,OAAN,CAAc9B,WAAd,CAAd;;AACAR,iBAAMuC,MAAN,CAAaF,KAAb,EAAoB,CAApB;;AACA,8BAAWtC,GAAX,EAAgB;AAAEyC,IAAAA,OAAO,EAAE;AAAX,GAAhB;AACD,CANM","sourcesContent":["import _ from 'lodash';\nimport cloudinary from 'cloudinary';\nimport Users from '../models/Users';\nimport { okResponse, badRequest } from '../utils/refractory';\nimport Properties from '../models/Properties';\n\nconst filterUsers = (users, query) => {\n  let filteredUsers = users;\n  if (query) {\n    filteredUsers = filteredUsers.filter(\n      u =>\n        u.user_type.toLowerCase().startsWith(query.toLowerCase())\n        || u.first_name.toLowerCase().startsWith(query.toLowerCase())\n        || u.last_name.toLowerCase().startsWith(query.toLowerCase())\n        || u.phone_number.toLowerCase().startsWith(query.toLowerCase())\n        || u.email.toLowerCase().startsWith(query.toLowerCase())\n        || u.is_active === query\n    );\n  }\n  return filteredUsers;\n};\n\n/*\n@@ Route          /api/v1/users\n@@ Method         GET\n@@ Description    Get all registered users.\n*/\nexport const getAllUser = ({ query }, res) => {\n  let users = filterUsers(Users, query.search);\n  if (!users.length) return badRequest(res, 'There is no matching record');\n  users = users.map(u => _.omit(u, ['password', 'token']));\n  okResponse(res, users);\n};\n\n/*\n@@ Route          /api/v1/users/me\n@@ Method         GET\n@@ Description    Get logged in user profile details.\n*/\nexport const getUserProfile = ({ user }, res) => {\n  const userProfile = Users.find(u => parseInt(u.id, 10) === parseInt(user.id, 10));\n  okResponse(res, _.omit(userProfile, ['password', 'token']));\n};\n\n/*\n@@ Route          /api/v1/users/:userId\n@@ Method         GET\n@@ Description    Get a single user and the advert he/she uploaded .\n*/\nexport const getUserProperties = ({ params }, res) => {\n  const user = Users.find(u => parseInt(u.id, 10) === parseInt(params.userId, 10));\n  if (!user) return badRequest(res, 'The user does not exist');\n  const userAdverts = Properties.filter(p => parseInt(p.owner, 10) === parseInt(params.userId, 10));\n  okResponse(res, { user: _.omit(user, ['password', 'token']), userAdverts });\n};\n\n/*\n@@ Route          /api/v1/users/:userId\n@@ Method         PATCH\n@@ Description    Update user profile details.\n*/\nexport const updateUserProfile = async ({ params, file, body }, res) => {\n  try {\n    const user = Users.find(u => parseInt(u.id, 10) === parseInt(params.userId, 10));\n    if (!user) return badRequest(res, 'The user does not exist');\n\n    const keys = Object.keys(body);\n    keys.forEach((key) => {\n      user[key] = body[key];\n    });\n\n    if (file) {\n      const result = await cloudinary.v2.uploader.upload(file.path);\n      user.image = result.secure_url;\n    }\n    return okResponse(res, { ..._.omit(user, ['password']) });\n  } catch (error) {\n    badRequest(res, 'Image not valid', 400);\n  }\n};\n\n/*\n@@ Route          /api/v1/users/:userId/activate\n@@ Method         PATCH\n@@ Description    Activate user account\n*/\nexport const activateDeactivateUserProfile = ({ params }, res) => {\n  const userProfile = Users.find(u => parseInt(u.id, 10) === parseInt(params.userId, 10));\n  if (!userProfile) return badRequest(res, 'The user profile does not exist');\n  userProfile.is_active = !userProfile.is_active;\n  okResponse(res, _.omit(userProfile, ['password', 'token']));\n};\n\n/*\n@@ Route          /api/v1/users/:userId\n@@ Method         DELETE\n@@ Description    Remove user account permanently from storage\n*/\nexport const deleteUserProfile = ({ params }, res) => {\n  const userProfile = Users.find(u => parseInt(u.id, 10) === parseInt(params.userId, 10));\n  if (!userProfile) return badRequest(res, 'The user profile does not exist or has been deleted');\n  const index = Users.indexOf(userProfile);\n  Users.splice(index, 1);\n  okResponse(res, { message: 'The user has been removed' });\n};\n"],"file":"users.js"}